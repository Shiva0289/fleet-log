
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fleet Log Book Entry</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 960px;
      margin: 30px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .col {
      flex: 1 1 30%;
      min-width: 250px;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    .buttons {
      text-align: center;
      margin-top: 20px;
    }
    .hidden {
      display: none;
    }
    @media (max-width: 600px) {
      .col {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fleet Log Book Entry</h1>

    <div id="g_id_onload"
         data-client_id="287460611306-r657t83lo11cjuim68ednnojetnpjg0s.apps.googleusercontent.com"
         data-callback="onSignIn"
         data-auto_prompt="false">
    </div>

    <div class="g_id_signin"
         data-type="standard"
         data-shape="rectangular"
         data-theme="outline"
         data-text="signin_with"
         data-size="large"
         data-logo_alignment="left">
    </div>

    <form id="logForm" class="hidden">
      <div class="row">
        <div class="col"><label>Date<input type="date" id="date" /></label></div>
        <div class="col"><label>Driver<input type="text" id="driver" /></label></div>
        <div class="col"><label>Vehicle<input type="text" id="vehicle" /></label></div>
        <div class="col"><label>Earnings<input type="number" id="earnings" /></label></div>
        <div class="col"><label>Cash Collection<input type="number" id="cash" /></label></div>
        <div class="col"><label>No. of Trips<input type="number" id="trips" /></label></div>
        <div class="col"><label>Toll<input type="number" id="toll" /></label></div>
        <div class="col"><label>Login Hours<input type="text" id="login" /></label></div>
        <div class="col"><label>Other Expense<input type="number" id="expense" /></label></div>
        <div class="col"><label>Uber Commission<input type="number" id="uber" /></label></div>
        <div class="col"><label>Pay %<input type="number" id="pay" /></label></div>
        <div class="col"><label>Salary<input type="number" id="salary" /></label></div>
        <div class="col"><label>CRFD<input type="number" id="crfd" /></label></div>
        <div class="col hidden"><label>P&L<input type="number" id="pl" /></label></div>
      </div>
      <div class="buttons">
        <button type="button" onclick="saveToSheet()">Save Entry</button>
      </div>
    </form>

    <div id="output" style="display:none; text-align:center; margin-top:10px;">Signed in successfully.</div>
  </div>

  <script>
    let tokenClient;
    const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
    const SHEET_ID = '19GeheC9UdPOUNrf_k3ItYYysWqhjEwzKgmfXM8POdXA';
    const SHEET_NAME = 'Database';

    function onSignIn(response) {
      tokenClient.callback = async (resp) => {
        if (resp.error) return console.error(resp);
        document.getElementById("logForm").classList.remove("hidden");
        document.querySelector(".g_id_signin").classList.add("hidden");
        document.getElementById("output").style.display = "block";
      };
      tokenClient.requestAccessToken();
    }

    function gapiLoaded() {
      gapi.load('client', async () => {
        await gapi.client.init({
          apiKey: "",
          discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
        });
      });
    }

    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: "287460611306-r657t83lo11cjuim68ednnojetnpjg0s.apps.googleusercontent.com",
        scope: SCOPES,
        callback: () => {}
      });
    }

    async function saveToSheet() {
      const values = [[
        date.value, driver.value, vehicle.value, earnings.value, cash.value,
        trips.value, toll.value, login.value, expense.value, uber.value,
        pay.value, salary.value, crfd.value, pl.value
      ]];

      try {
        await gapi.client.sheets.spreadsheets.values.append({
          spreadsheetId: SHEET_ID,
          range: `${SHEET_NAME}!A1`,
          valueInputOption: "USER_ENTERED",
          resource: { values }
        });
        alert("Entry saved!");
      } catch (err) {
        alert("Error saving to sheet: " + err.result?.error?.message);
      }
    }

    window.onload = () => {
      gapiLoaded();
      gisLoaded();
    };
  </script>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>
</body>
</html>
